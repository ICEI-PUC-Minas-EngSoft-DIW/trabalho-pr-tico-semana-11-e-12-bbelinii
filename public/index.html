<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>2-Step Blog</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="site-header">
        <div class="header-inner">
            <div class="logo">
                <img src="imagens/logo.png" alt="2-Step logo">
            </div>
            <nav class="site-nav">
                <ul>
                    <li><a href="#">Início</a></li>
                    <li><a href="#">Categorias</a></li>
                    <li><a href="#">Postagens</a></li>
                    <li><a href="#">Entrar</a></li>
                </ul>
            </nav>
        </div>
    </header>
    <section class="banner">
        <p>O seu conhecimento pode sanar a curiosidade de alguém!</p>
    </section>
    <main class="container">
        <aside class="menul">
        <nav class="principais">
            <p class="title">Categorias:</p>
            <ul>
                <li>Motores</li>
                <li>Turbo</li>
                <li>Elétrica</li>
                <li>Estética</li>
                <li>Injeção Programável</li>
                <li>Reprogramação Eletrônica</li>
            </ul>
        </nav>
    </aside>
        <section class="menur">
            <div class="busca">
                <input type="text" id="busca" placeholder="Buscar Postagem...">
                <button id="criar">Criar nova postagem</button>
            </div>
            <form id="form-postagem" class="form-postagem">
                <input type="hidden" id="post-id">
                <div class="grid">
                    <input type="text" id="autor" placeholder="Autor" required>
                    <input type="text" id="data" placeholder="Data de publicação" required>
                    <input type="text" id="membro" placeholder="Membro desde" required>
                    <input type="text" id="imagem" placeholder="URL da imagem" value="imagens/sherek.jpg" required>
                </div>
                <textarea id="texto" placeholder="Texto" rows="4" required></textarea>
                <div class="acoes">
                    <button type="submit" id="salvar">Salvar</button>
                    <button type="button" id="limpar">Limpar</button>
                </div>
            </form>
            <h3>Postagens</h3>
            <div class="postagens">
                <article class="postagem">
                    <img src="imagens/sherek.jpg" alt="autor">
                    <div class="conteudo">
                        <h4>Autor: Pedro Henrique</h4>
                        <p class="data">Data de publicação: 12 de setembro de 2025</p>
                        <p class="texto">Fala pessoal, passando pra compartilhar uma situação chata que rolou com meu Fastback Abarth. Sempre gostei do carro, mas ultimamente venho percebendo um barulho estranho na suspensão...</p>
                        <p class="membro">Membro desde: 10/06/2025</p>
                    </div>
                </article>
                <article class="postagem">
                    <img src="imagens/barney.jpeg" alt="autor">
                    <div class="conteudo">
                        <h4>Autor: Maria Clara</h4>
                        <p class="data">Data de publicação: 10 de setembro de 2025</p>
                        <p class="texto">Oi pessoal, vim compartilhar um problema que está me incomodando no meu Honda Civic. Nas últimas semanas, notei um barulho estranho vindo da suspensão...</p>
                        <p class="membro">Membro desde: 19/04/2025</p>
                    </div>
                </article>
            </div>
        </section>
    </main>
    <footer class="site-footer">
        <p>Copyright @ 2025 - 2-Step Automotive Blog</p>
        <img src="imagens/Logo Footer.png" alt="Logo footer">
    </footer>
    <script src="app.js"></script>
    <script>
        function criarPostagem(post) {
            const article = document.createElement('article');
            article.className = 'postagem';
            
            let textoResumido = post.texto;
            if (textoResumido.length > 150) {
                textoResumido = textoResumido.substring(0, 150) + '...';
            }
            
            article.innerHTML = `
                <img src="${post.imagem}" alt="autor">
                <div class="conteudo">
                    <h4>Autor: ${post.autor}</h4>
                    <p class="data">Data de publicação: ${post.data}</p>
                    <p class="texto">${textoResumido}</p>
                    <p class="membro">Membro desde: ${post.membro}</p>
                    <div class="crud-botoes">
                        <button class="editar">Editar</button>
                        <button class="excluir">Excluir</button>
                    </div>
                </div>
            `;
            
            article.onclick = function() {
                window.location.href = 'postagem.html?id=' + post.id;
            };

            article.querySelector('.editar').onclick = function(e) {
                e.stopPropagation();
                preencherFormulario(post);
            };
            article.querySelector('.excluir').onclick = async function(e) {
                e.stopPropagation();
                if (confirm('Deseja excluir esta postagem?')) {
                    await window.deletarPostagemAPI(post.id);
                    await window.carregarPostagens();
                    mostrarPostagens();
                }
            };
            
            return article;
        }
        
        function mostrarPostagens() {
            const container = document.querySelector('.postagens');
            container.innerHTML = '';
            if (!window.postagens || !Array.isArray(window.postagens)) return;
            for (let i = 0; i < window.postagens.length; i++) {
                const postagem = criarPostagem(window.postagens[i]);
                container.appendChild(postagem);
            }
        }
        
        function buscarPostagens() {
            const termoBusca = document.getElementById('busca').value.toLowerCase();
            const container = document.querySelector('.postagens');
            container.innerHTML = '';
            
            if (!window.postagens) return;
            for (let i = 0; i < window.postagens.length; i++) {
                const post = window.postagens[i];
                
                if (post.autor.toLowerCase().includes(termoBusca) || 
                    post.texto.toLowerCase().includes(termoBusca)) {
                    
                    const postagem = criarPostagem(post);
                    container.appendChild(postagem);
                }
            }
        }
        
        function limparFormulario() {
            document.getElementById('post-id').value = '';
            document.getElementById('autor').value = '';
            document.getElementById('data').value = '';
            document.getElementById('texto').value = '';
            document.getElementById('membro').value = '';
            document.getElementById('imagem').value = 'imagens/sherek.jpg';
        }
        
        function preencherFormulario(post) {
            document.getElementById('post-id').value = post.id || '';
            document.getElementById('autor').value = post.autor || '';
            document.getElementById('data').value = post.data || '';
            document.getElementById('texto').value = post.texto || '';
            document.getElementById('membro').value = post.membro || '';
            document.getElementById('imagem').value = post.imagem || 'imagens/sherek.jpg';
        }
        
        async function salvarFormulario(event) {
            event.preventDefault();
            const id = document.getElementById('post-id').value.trim();
            const novo = {
                autor: document.getElementById('autor').value.trim(),
                data: document.getElementById('data').value.trim(),
                texto: document.getElementById('texto').value.trim(),
                membro: document.getElementById('membro').value.trim(),
                imagem: document.getElementById('imagem').value.trim() || 'imagens/sherek.jpg'
            };
            if (!novo.autor || !novo.data || !novo.texto || !novo.membro) {
                alert('Preencha todos os campos.');
                return;
            }
            if (id) {
                await window.atualizarPostagemAPI(id, { id, ...novo });
                alert('Postagem atualizada!');
            } else {
                const criado = await window.criarPostagemAPI(novo);
                alert('Postagem criada com id ' + criado.id);
            }
            limparFormulario();
            await window.carregarPostagens();
            mostrarPostagens();
        }

        window.onload = async function() {
            await window.carregarPostagens();
            mostrarPostagens();
            document.getElementById('busca').oninput = buscarPostagens;
            document.getElementById('criar').onclick = function(){
                limparFormulario();
                document.getElementById('autor').focus();
            };
            document.getElementById('form-postagem').addEventListener('submit', salvarFormulario);
            document.getElementById('limpar').onclick = limparFormulario;
        };
    </script>
</body>
</html>